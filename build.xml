<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ant-project>
<project name="mdm" basedir="." default="bang">
	<description>
  Modern Dependancy Management automates the organization of a project and the 
  libraries it depends on with clever git submodules, giving you a project
  structure that is:
   - strongly versioned and guaranteed repeatable builds!
   - checking out a project gives you exactly everything you need to do a build!
   - your repository doesn't bloat over time and doing a fresh clone ships you 
     the bare minimum number of bytes that you need!
	</description>
	<property name="app" value="mdm"/>
	<import file="lib/exus-build/build-exultant.xml"/>
	
	
	<target name="init" depends="exusInitId">
		<mkdir dir="${src}"/>
		<mkdir dir="${lib}"/>
		<mkdir dir="${build}"/>
		<mkdir dir="${dist}"/>
	</target>
	
	
	<target name="zip"
		depends="init"
		description="zip the source and libraries together"
		>
		<exusPack destfile="${build}/${app}.zip">
			<fileset dir="${src}"/>
			<!-- there may well be a better way to structure this than dumping files together, but I don't know python's import resolution very well yet so I'm going to "KISS" until it bites me. -->
			<fileset file="${lib}/pbs/pbs.py"/>
		</exusPack>
	</target>
	<target name="bang"
		depends="zip"
		description="cat a shebang onto the front of the zip file so that it Just Works when run"
		>
		<concat destfile="${dist}/${app}" binary="true">
			<concat>#!/usr/bin/env python
</concat>
			<fileset file="${build}/${app}.zip" />
		</concat>
		<chmod file="${dist}/${app}" perm="755" />
	</target>
	
	
	<target name="clean" description="clean up">
		<delete dir="${build}"/>
		<delete dir="${dist}"/>
	</target>
	
	
	<target name="release" depends="clean, bang">
		<exec executable="mdm">
			<arg value="release" />
			<arg value="--version=${version}" />
			<arg value="--files=${dist}" />
		</exec>
	</target>
</project>
